<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root { --bg: #1a1d21; --card: #2c3036; --blue: #0dcaf0; --dim: #555; }
    body { background: var(--bg); color: white; padding: 20px; font-family: sans-serif; }
    .status-card { background: var(--card); border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
    
    .timeline { position: relative; padding: 0; margin: 20px 0; list-style: none; }
    .t-item { position: relative; padding-left: 40px; margin-bottom: 25px; color: var(--dim); transition: 0.3s; }
    .t-item::before { content: ""; position: absolute; left: 6px; top: 0; bottom: -25px; width: 2px; background: var(--dim); }
    .t-item:last-child::before { display: none; }
    .t-icon { position: absolute; left: 0; top: 4px; width: 14px; height: 14px; border-radius: 50%; background: var(--dim); border: 2px solid var(--bg); z-index: 2; }
    
    .active { color: var(--blue); font-weight: bold; }
    .active .t-icon { background: var(--blue); box-shadow: 0 0 12px var(--blue); transform: scale(1.2); }
    .done { color: #ccc; }
    .done .t-icon { background: var(--blue); }
    .done::before { background: var(--blue); }
  </style>
</head>
<body>

  <div id="loader" class="text-center mt-5"><div class="spinner-border text-info"></div></div>

  <div id="content" style="display:none;">
    <h4 class="mb-4 text-center">üì¶ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h4>
    <div class="status-card">
      <div id="timeline-box" class="timeline"></div>
      <hr style="border-color: #444;">
      <div class="small"><span class="text-secondary">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</span> <span id="o-id"></span></div>
      <div class="small"><span class="text-secondary">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</span> <span id="o-items"></span></div>
      <div class="small text-secondary mt-2" id="o-time"></div>
    </div>
    <a href="index.html" class="btn btn-outline-info w-100 p-3 mt-4 rounded-pill">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</a>
  </div>

<script>
const GAS_API = "https://script.google.com/macros/s/AKfycbyVPS8a_dSnSSy75YdDREQHsbNm2NehMtXmjMbbjnAJI86i0epfj6UTGMu92O0sZC6B6A/exec"; 

async function init() {
  await liff.init({ liffId: "2008821220-URtBKHjL" });
  if (!liff.isLoggedIn()) { liff.login(); return; }
  const profile = await liff.getProfile();

  fetch(`${GAS_API}?type=status&uid=${profile.userId}`)
    .then(res => res.json())
    .then(res => {
      document.getElementById("loader").style.display = "none";
      if (!res.order) { alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î"); return; }
      
      document.getElementById("content").style.display = "block";
      const box = document.getElementById("timeline-box");
      const currentIdx = res.allStatus.indexOf(res.order.status);
      
      res.allStatus.forEach((name, i) => {
        const div = document.createElement("div");
        div.className = "t-item " + (i < currentIdx ? "done" : (i === currentIdx ? "active" : ""));
        div.innerHTML = `<div class="t-icon"></div>${name}`;
        box.appendChild(div);
      });

      document.getElementById("o-id").innerText = res.order.id;
      document.getElementById("o-items").innerText = res.order.items;
      document.getElementById("o-time").innerText = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: " + res.order.time;
    });
}
window.onload = init;
</script>
</body>
</html>
