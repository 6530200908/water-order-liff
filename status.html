<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #1a1d21; color: white; padding: 20px; }
        .t-item { position: relative; padding-left: 35px; margin-bottom: 25px; color: #666; }
        .t-item.active { color: #0dcaf0; font-weight: bold; }
        .t-item.done { color: #fff; }
        .t-icon { position: absolute; left: 0; top: 0; width: 20px; height: 20px; border-radius: 50%; border: 2px solid #444; background: #1a1d21; }
        .done .t-icon { background: #0dcaf0; border-color: #0dcaf0; }
        .active .t-icon { border-color: #0dcaf0; box-shadow: 0 0 10px #0dcaf0; }
    </style>
</head>
<body>
    <div id="loader" class="text-center mt-5"><div class="spinner-border text-info"></div></div>
    <div id="content" style="display:none;">
        <h4 class="mb-4">üì¶ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
        <div id="timeline-box"></div>
        <hr>
        <div class="small text-muted">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå: <span id="o-id"></span></div>
        <div class="small text-muted">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: <span id="o-items"></span></div>
    </div>

<script>
const GAS_API = "https://script.google.com/macros/s/AKfycbw-4Oz0k-XYZVypd9O7NxxYOJabu2ikch90-j2_aeUF8u6PToahfDn4nfuKK-ZiX5FyRQ/exec"; 
async function init() {
    await liff.init({ liffId: "2008821220-URtBKHjL" });
    if(!liff.isLoggedIn()){ liff.login(); return; }
    const profile = await liff.getProfile();

    fetch(`${GAS_API}?type=status&uid=${profile.userId}`)
    .then(res => res.json())
    .then(res => {
        document.getElementById("loader").style.display = "none";
        if(!res.order) { document.body.innerHTML = "<div class='text-center mt-5'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>"; return; }
        document.getElementById("content").style.display = "block";
        document.getElementById("o-id").innerText = res.order.id;
        document.getElementById("o-items").innerText = res.order.items;

        const box = document.getElementById("timeline-box");
        const mainSteps = res.statusMaster.filter(s => !s.id.includes('.'));
        const activeIdx = mainSteps.findIndex(s => s.desc === res.order.status);

        mainSteps.forEach((s, i) => {
            const div = document.createElement("div");
            div.className = `t-item ${i < activeIdx ? 'done' : (i === activeIdx ? 'active' : '')}`;
            div.innerHTML = `<div class="t-icon"></div>${s.desc}`;
            box.appendChild(div);
        });
    });
}
window.onload = init;
</script>
</body>
</html>
