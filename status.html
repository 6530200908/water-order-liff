<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --accent: #0dcaf0; --bg-card: #2c3036; }
        body { background: #1a1d21; color: white; padding: 25px; font-family: -apple-system, sans-serif; }
        
        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå */
        .order-info-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #3e444d;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .order-id { font-size: 1.4rem; font-weight: 800; color: var(--accent); margin-bottom: 5px; }
        .order-items { font-size: 1.1rem; color: #ffffff; line-height: 1.5; }
        .label-text { color: #adb5bd; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }

        /* Timeline ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà */
        .timeline-container { padding: 10px 5px; }
        .t-item { position: relative; padding-left: 45px; margin-bottom: 35px; color: #6c757d; font-size: 1.1rem; transition: all 0.3s; }
        .t-item:last-child { margin-bottom: 0; }
        
        /* ‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏∏‡∏î */
        .t-item::after {
            content: '';
            position: absolute;
            left: 11px;
            top: 25px;
            width: 2px;
            height: calc(100% + 15px);
            background: #3e444d;
        }
        .t-item:last-child::after { display: none; }

        /* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏° */
        .t-icon {
            position: absolute;
            left: 0;
            top: 2px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #444;
            background: #1a1d21;
            z-index: 2;
        }

        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß (Done) */
        .t-item.done { color: #ffffff; }
        .done .t-icon { background: var(--accent); border-color: var(--accent); }
        .done::after { background: var(--accent); }

        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Active) */
        .t-item.active { color: var(--accent); font-weight: bold; font-size: 1.25rem; }
        .active .t-icon { 
            border-color: var(--accent); 
            background: var(--accent);
            box-shadow: 0 0 15px rgba(13, 202, 240, 0.6);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        #loader { margin-top: 100px; }
    </style>
</head>
<body>
    <div id="loader" class="text-center">
        <div class="spinner-border text-info" style="width: 3rem; height: 3rem;"></div>
        <div class="mt-3 text-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...</div>
    </div>

    <div id="content" style="display:none;">
        <h3 class="fw-bold mb-4 text-white">üì¶ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
        
        <div class="order-info-card">
            <div class="mb-3">
                <div class="label-text">Order ID</div>
                <div id="o-id" class="order-id">---</div>
            </div>
            <div>
                <div class="label-text">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                <div id="o-items" class="order-items">---</div>
            </div>
        </div>

        <div class="timeline-container" id="timeline-box"></div>
        
        <div class="text-center mt-5">
            <button onclick="liff.closeWindow()" class="btn btn-outline-secondary rounded-pill px-4">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>
    </div>

<script>
// ‡πÉ‡∏™‡πà URL API ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
const GAS_API = "https://script.google.com/macros/s/AKfycbyRTDZ3jsh3n0ggI2bguAvVbnxYfIFS1ckr7X3Fp1NIWaGAwq-8Hssw6baFCqwVwea2sw/exec"; 

async function init() {
    await liff.init({ liffId: "2008821220-URtBKHjL" });
    if(!liff.isLoggedIn()){ liff.login(); return; }
    const profile = await liff.getProfile();

    fetch(`${GAS_API}?type=status&uid=${profile.userId}`)
    .then(res => res.json())
    .then(res => {
        document.getElementById("loader").style.display = "none";
        if(!res.order) { 
            document.body.innerHTML = `
                <div class='text-center mt-5'>
                    <h5 class='text-muted'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h5>
                    <button onclick='liff.closeWindow()' class='btn btn-info mt-3'>‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                </div>`; 
            return; 
        }

        document.getElementById("content").style.display = "block";
        document.getElementById("o-id").innerText = res.order.id;
        document.getElementById("o-items").innerText = res.order.items;

        const box = document.getElementById("timeline-box");
        const mainSteps = res.statusMaster.filter(s => !s.id.includes('.'));
        const activeIdx = mainSteps.findIndex(s => s.desc === res.order.status);

        box.innerHTML = ""; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
        mainSteps.forEach((s, i) => {
            const div = document.createElement("div");
            let state = "";
            if (i < activeIdx) state = "done";
            else if (i === activeIdx) state = "active";
            
            div.className = `t-item ${state}`;
            div.innerHTML = `<div class="t-icon"></div>${s.desc}`;
            box.appendChild(div);
        });
    })
    .catch(err => {
        document.getElementById("loader").innerHTML = "<div class='text-danger'>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>";
    });
}
window.onload = init;
</script>
</body>
</html>
