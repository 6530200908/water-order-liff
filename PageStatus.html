<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="Styles.css">
</head>
<body>
  <div id="loader"><div class="spinner-border text-info"></div></div>
  <div id="page-status" class="container mt-3">
    <h3 class="fw-bold mb-4 text-info">üì¶ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
    <div class="order-card p-3 mb-4 bg-dark rounded-4 shadow-sm">
        <div class="small text-muted mb-1">ORDER ID</div>
        <div id="o-id" class="h4 fw-bold text-info">---</div>
        <div class="small text-muted mt-3 mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
        <div id="o-items" class="fw-bold">---</div>
    </div>
    <div id="timeline-box" class="mt-4"></div> 
  </div>

  <script src="Config.js"></script>
  <script>
    async function init() {
      try {
        await liff.init({ liffId: CONFIG.LIFF_ID_STATUS });
        if (!liff.isLoggedIn()) { liff.login(); return; }
        const profile = await liff.getProfile();
        const res = await fetch(`${CONFIG.GAS_API}?type=status&uid=${profile.userId}`).then(r => r.json());
        
        if(!res.order) { 
          document.getElementById("page-status").innerHTML = "<p class='text-center mt-5 text-muted'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>"; 
          return; 
        }
        document.getElementById("o-id").innerText = res.order.id;
        document.getElementById("o-items").innerText = res.order.items;
        
        const box = document.getElementById("timeline-box");
        box.innerHTML = ""; 
        const steps = res.statusMaster.filter(s => !s.id.includes('.'));
        const activeIdx = steps.findIndex(s => s.desc === res.order.status);
        
        steps.forEach((s, i) => {
          const div = document.createElement("div");
          div.className = `t-item ${i < activeIdx ? 'done' : (i === activeIdx ? 'active' : '')}`;
          div.innerHTML = `<div class="t-icon"></div><div class="t-text">${s.desc}</div>`;
          box.appendChild(div);
        });
      } catch (e) { console.error(e); }
      finally { document.getElementById("loader").style.display = "none"; }
    }
    window.onload = init;
  </script>
</body>
</html>
