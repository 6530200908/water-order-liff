<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="Styles.css">
</head>
<body>
  <div id="page-status">
    <h4 class="fw-bold mb-4 mt-2">üì¶ ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h4>
    
    <div class="order-card shadow">
        <div class="small text-muted mb-1 fw-bold">ORDER ID</div>
        <div id="o-id" class="h4 fw-bold">ORD-XXXXXXXX</div>
        
        <div class="small text-muted mt-4 mb-1 fw-bold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
        <div id="o-items" class="h5 fw-normal">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
    </div>

    <div id="timeline-box" class="mt-5">
        </div>
  </div>

  <script src="Config.js"></script>
  <script>
    async function init() {
      try {
        await liff.init({ liffId: CONFIG.LIFF_ID_STATUS });
        if (!liff.isLoggedIn()) { liff.login(); return; }
        const profile = await liff.getProfile();
        const res = await fetch(`${CONFIG.GAS_API}?type=status&uid=${profile.userId}`).then(r => r.json());
        
        if(!res.order) {
           document.getElementById("page-status").innerHTML = "<div class='text-center mt-5 text-muted'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>";
           return;
        }

        document.getElementById("o-id").innerText = res.order.id;
        document.getElementById("o-items").innerText = res.order.items;
        
        const box = document.getElementById("timeline-box");
        const steps = res.statusMaster;
        const activeIdx = steps.findIndex(s => s.desc.trim() === res.order.status.trim());

        box.innerHTML = steps.map((s, i) => `
          <div class="t-item ${i < activeIdx ? 'done' : (i === activeIdx ? 'active' : '')}">
            <div class="t-icon"></div>
            <div class="t-text">${s.desc}</div>
          </div>
        `).join("");

      } catch (e) { console.error(e); }
    }
    window.onload = init;
  </script>
</body>
</html>
